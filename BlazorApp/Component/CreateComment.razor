@using BlazorApp.Services
@using Shared.Model
@inject ApiService Api

<div style="margin-top:20px;">
    <h4>Skriv en kommentar</h4>

    <input @bind="author"
           placeholder="Dit navn"
           style="width:100%; padding:6px; border-radius:5px; border:1px solid #ccc; margin-bottom:6px;" />

    <textarea @bind="content"
              placeholder="Din kommentar..."
              style="width:100%; padding:6px; border-radius:5px; border:1px solid #ccc; height:80px;"></textarea>

    <button @onclick="CreateNewComment"
            style="margin-top:8px; padding:6px 12px;">Kommentér</button>

    @if (!string.IsNullOrEmpty(statusMessage))
    {
        <p style="color:gray; font-size:0.9em;">@statusMessage</p>
    }
</div>

@code {
    [Parameter] public int PostId { get; set; }
    [Parameter] public EventCallback OnCommentAdded { get; set; }

    private string author = string.Empty;
    private string content = string.Empty;
    private string? statusMessage;

    private async Task CreateNewComment()
    {
        if (string.IsNullOrWhiteSpace(author) || string.IsNullOrWhiteSpace(content))
        {
            statusMessage = "Udfyld både navn og kommentar!";
            return;
        }

        // Brug ApiService til at oprette kommentaren
        Post? updatedPost = await Api.AddComment(PostId, content, author);

        if (updatedPost != null)
        {
            statusMessage = "Kommentar tilføjet!";
            content = string.Empty;
            author = string.Empty;

            if (OnCommentAdded.HasDelegate)
                await OnCommentAdded.InvokeAsync();
        }
        else
        {
            statusMessage = "Kunne ikke tilføje kommentaren.";
        }
    }
}