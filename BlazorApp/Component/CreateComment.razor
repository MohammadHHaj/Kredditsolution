@using BlazorApp.Services
@using Shared.Model
@inject ApiService Api

<div class="create-post-container">
    <h4>Skriv en kommentar</h4>

    <input @bind="author" placeholder="Dit navn..." />
    <textarea @bind="content" placeholder="Din kommentar..."></textarea>

    <button @onclick="CreateNewComment">Kommentér</button>

    @if (!string.IsNullOrEmpty(statusMessage))
    {
        <p class="@statusClass">@statusMessage</p>
    }
</div>

@code {
    [Parameter] public int PostId { get; set; }
    [Parameter] public EventCallback OnCommentAdded { get; set; }

    private string author = string.Empty;
    private string content = string.Empty;
    private string? statusMessage;
    private string? statusClass;

    private async Task CreateNewComment()
    {
        if (string.IsNullOrWhiteSpace(author) || string.IsNullOrWhiteSpace(content))
        {
            statusMessage = "Udfyld både navn og kommentar!";
            statusClass = "error-message";
            return;
        }

        Post? updatedPost = await Api.AddComment(PostId, content, author);

        if (updatedPost != null)
        {
            statusMessage = "Kommentar tilføjet!";
            statusClass = "success-message";

            content = string.Empty;
            author = string.Empty;

            if (OnCommentAdded.HasDelegate)
                await OnCommentAdded.InvokeAsync();
        }
        else
        {
            statusMessage = "Kunne ikke tilføje kommentaren.";
            statusClass = "error-message";
        }
    }
}